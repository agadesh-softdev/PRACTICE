<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CRUD API</title>
    <link rel="icon" type="image" href="./ASSETS/fav_icon.png" />
    <style>
      body {
        font-family: "Lucida Sans", "Lucida Sans Regular", "Lucida Grande",
          "Lucida Sans Unicode", Geneva, Verdana, sans-serif;
      }
      .boss {
        display: flex;
        flex-direction: column;
        gap: 50px;
      }
      form input {
        padding: 5px;
        height: 30px;
        font-size: large;
        width: 20%;
        border: black 2px solid;
        border-radius: 13px;
        margin-right: 30px;
      }
      .form {
        background-color: lightblue;
        padding: 30px;
        border-radius: 13px;
        border: black 2px solid;
        width: 80%;
        margin: auto;
      }
      #addBtn {
        height: 40px;
        font-size: large;
        width: 100px;
        background-color: blue;
        color: white;
        border-radius: 13px;
      }
      table,
      tr,
      th,
      td {
        border: 2px solid black;
        border-collapse: collapse;
        padding: 15px;
        font-size: large;
      }
      table {
        width: 80%;
        margin: auto;
        text-align: center;
        border-radius: 20px;
      }
      .one {
        width: 100px;
      }
      th {
        height: 30px;
      }
      .noTask {
        text-align: center;
        margin-top: 20px;
      }
      .delete-button,
      .task-button {
        padding: 10px;
        background-color: blue;
        color: white;
        font-size: large;
        border-radius: 13px;
      }
      .delete-button:hover,
      .task-button:hover,
      #addBtn:hover {
        opacity: 0.8;
      }
      .delete-button:active,
      .task-button:active,
      #addBtn:active {
        scale: 0.8;
      }
      .two {
        background-color: red;
      }
    </style>
  </head>
  <body>
    <h2>Full Crud Example</h2>
    <div class="boss">
      <div class="form">
        <form id="taskForm">
          <input
            type="text"
            name="name"
            id="name"
            placeholder="Name"
            required
          />
          <input
            type="text"
            name="email"
            id="email"
            placeholder="Email"
            required
          />
          <input
            type="tel"
            name="phone"
            id="phone"
            placeholder="Phone"
            required
          />
          <button id="addBtn">Add task</button>
        </form>
      </div>
      <div class="table">
        <table>
          <thead>
            <tr>
              <th id="one">S.No</th>
              <th>Name</th>
              <th>Email</th>
              <th>Phone</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="taskTableBody"></tbody>
        </table>
        <div class="noTask" id="noTask" style="display: none">
          No Task Found !!!
        </div>
      </div>
    </div>
    <script>
      let tasks = [];
      const taskTableBody = document.getElementById("taskTableBody");
      const taskForm = document.getElementById("taskForm");
      const noTask = document.getElementById("noTask");
      const submitButton = taskForm.querySelector("button");
      let isEditing = false;
      let currentTaskId = null;
      const serverUrl = "https://68ad07cdb996fea1c08b65ec.mockapi.io/crud";

      function fetchTasks() {
        fetch(serverUrl)
          .then((res) => {
            if (res) {
              return res.json();
            }
          })
          .then((data) => {
            tasks = data;
            renderTasks();
            alert("Tasks loaded successfully.");
          })
          .catch((error) => {
            console.log("Failed to fetch data", error);
          });
      }
      function renderTasks() {
        if (tasks.length === 0) {
          noTask.style.display = "block";
          taskTableBody.innerHTML = "";
        } else {
          noTask.style.display = "none";
          taskTableBody.innerHTML = tasks
            .map((task) => {
              return `
              
          <tr>
            <td>${task.id}</td>
            <td>${task.name}</td>
            <td>${task.email}</td>
            <td>${task.phone}</td>
            <td>
              <div class="action-buttons">
                <button class="task-button" onclick="editTask('${task.id}')">Edit</button>
                <button class="delete-button two" onclick="deleteTask('${task.id}')">Delete</button>
              </div>
            </td>
          </tr>
        `;
            })
            .join("");
        }
      }

      taskForm.addEventListener("submit", (event) => {
        event.preventDefault();
        const name = document.getElementById("name").value;
        const phone = document.getElementById("phone").value;
        const email = document.getElementById("email").value;

        //EDIT
        if (isEditing) {
          fetch(`${serverUrl}/${currentTaskId}`, {
            method: "PUT",
            headers: { "content-type": "application/json" },
            body: JSON.stringify({ name, email, phone }),
          })
            .then((res) => {
              return res.json();
            })
            .then((updatedTask) => {
              tasks = tasks.map((task) =>
                task.id === updatedTask.id ? updatedTask : task
              );
              alert("Task updated successfully");
              renderTasks();
              resetForm();
            })
            .catch((error) => {
              console.log("Failed to edit Task", error);
            });
        }
        //ADD
        else {
          fetch(serverUrl, {
            method: "POST",
            headers: { "content-type": "application/json" },
            body: JSON.stringify({ name, email, phone }),
          })
            .then((res) => {
              return res.json();
            })
            .then((newTask) => {
              tasks.push(newTask);
              alert("Task added successfully");
              renderTasks();
              resetForm();
            })
            .catch((error) => {
              console.log("Failed to add Task", error);
            });
        }
      });

      function editTask(id) {
        let data = tasks.find((t) => t.id === id);
        if (!data) return;
        document.getElementById("name").value = data.name;
        document.getElementById("email").value = data.email;
        document.getElementById("phone").value = data.phone;
        isEditing = true;
        currentTaskId = id;
        submitButton.textContent = "Edit Task";
      }

      function deleteTask(id) {
        fetch(`${serverUrl}/${id}`, {
          method: "DELETE",
        })
          .then((res) => {
            if (res.ok) {
              tasks = tasks.filter((task) => task.id !== id);
              alert("Task deleted successfully.");
              renderTasks();
              resetForm();
            }
          })
          .catch((error) => {
            console.log("Failed To delete Task", error);
          });
      }

      function resetForm() {
        isEditing = false;
        currentTaskId = null;
        taskForm.reset();
        submitButton.textContent = "Add Task";
      }

      fetchTasks();
    </script>
  </body>
</html>
